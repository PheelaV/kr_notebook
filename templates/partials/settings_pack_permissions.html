<!-- Pack permissions panel - used by HTMX refresh -->
<div id="pack-permissions-{{ pack.id }}" class="mt-2 p-3 bg-gray-50 dark:bg-gray-700/50 rounded">
  {% if pack.is_public %}
  <!-- Pack is public -->
  <p class="text-xs text-green-600 dark:text-green-400 mb-2">
    Available to all users.
  </p>
  <button type="button"
          hx-post="/settings/pack/{{ pack.id }}/make-private"
          hx-target="#pack-permissions-{{ pack.id }}"
          hx-swap="outerHTML"
          hx-confirm="Make {{ pack.name }} admin-only (or restricted to specific users/groups)?"
          class="text-xs px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded hover:bg-amber-200 dark:hover:bg-amber-900/50">
    Make Private
  </button>
  {% else if pack.is_restricted %}
  <!-- Pack has specific user/group restrictions -->
  <p class="text-xs text-amber-600 dark:text-amber-400 mb-2">
    Restricted to specific groups/users.
  </p>
  <!-- Allowed Groups -->
  {% if !pack.allowed_groups.is_empty() %}
  <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Groups:</p>
  <div class="flex flex-wrap gap-1 mb-2">
    {% for group_id in &pack.allowed_groups %}
    <span class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300">
      {{ group_id }}
      <button type="button"
              hx-post="/settings/pack/permission/remove"
              hx-vals='{"pack_id": "{{ pack.id }}", "group_id": "{{ group_id }}"}'
              hx-target="#pack-permissions-{{ pack.id }}"
              hx-swap="outerHTML"
              class="hover:text-red-600 dark:hover:text-red-400" title="Remove">×</button>
    </span>
    {% endfor %}
  </div>
  {% endif %}
  <!-- Allowed Users -->
  {% if !pack.allowed_users.is_empty() %}
  <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Users:</p>
  <div class="flex flex-wrap gap-1 mb-2">
    {% for user in &pack.allowed_users %}
    <span class="inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300">
      {{ user.username }}
      <button type="button"
              hx-post="/settings/pack/user-permission/remove"
              hx-vals='{"pack_id": "{{ pack.id }}", "user_id": "{{ user.id }}"}'
              hx-target="#pack-permissions-{{ pack.id }}"
              hx-swap="outerHTML"
              class="hover:text-red-600 dark:hover:text-red-400" title="Remove">×</button>
    </span>
    {% endfor %}
  </div>
  {% endif %}
  <button type="button"
          hx-post="/settings/pack/{{ pack.id }}/make-public"
          hx-target="#pack-permissions-{{ pack.id }}"
          hx-swap="outerHTML"
          hx-confirm="Make {{ pack.name }} available to all users?"
          class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50">
    Make Public
  </button>
  {% else %}
  <!-- Pack is admin-only (no permissions set) -->
  <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
    Admin-only. Add users/groups below or make public.
  </p>
  <button type="button"
          hx-post="/settings/pack/{{ pack.id }}/make-public"
          hx-target="#pack-permissions-{{ pack.id }}"
          hx-swap="outerHTML"
          hx-confirm="Make {{ pack.name }} available to all users?"
          class="text-xs px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50">
    Make Public
  </button>
  {% endif %}
  <!-- Add group restriction -->
  {% if !groups.is_empty() %}
  <form hx-post="/settings/pack/permission/add"
        hx-target="#pack-permissions-{{ pack.id }}"
        hx-swap="outerHTML"
        class="flex gap-2 mt-2">
    <input type="hidden" name="pack_id" value="{{ pack.id }}">
    <select name="group_id" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
      {% for group in &groups %}
      <option value="{{ group.id }}">{{ group.name }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="px-2 py-1 text-xs bg-amber-600 text-white rounded hover:bg-amber-700">
      + Group
    </button>
  </form>
  {% endif %}
  <!-- Add user restriction -->
  {% if !users.is_empty() %}
  <form hx-post="/settings/pack/user-permission/add"
        hx-target="#pack-permissions-{{ pack.id }}"
        hx-swap="outerHTML"
        class="flex gap-2 mt-2">
    <input type="hidden" name="pack_id" value="{{ pack.id }}">
    <select name="user_id" class="flex-1 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
      {% for user in &users %}
      <option value="{{ user.id }}">{{ user.username }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="px-2 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700">
      + User
    </button>
  </form>
  {% endif %}
  {% if groups.is_empty() && users.is_empty() %}
  <p class="text-xs text-gray-400 mt-2 italic">Create groups or users to restrict pack access.</p>
  {% endif %}
</div>
